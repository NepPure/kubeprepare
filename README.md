# KubeEdge 1.22 ç¦»çº¿å®‰è£…é¡¹ç›®

## ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ KubeEdge 1.22 ç¦»çº¿å®‰è£…è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š
- **äº‘ç«¯**ï¼šk3s + KubeEdge CloudCoreï¼ˆæ”¯æŒ amd64/arm64ï¼‰
- **è¾¹ç¼˜ç«¯**ï¼šcontainerd + runc + KubeEdge EdgeCoreï¼ˆæ”¯æŒ amd64/arm64ï¼‰

æ”¯æŒåœ¨**å®Œå…¨ç¦»çº¿ç¯å¢ƒ**ä¸‹å¿«é€Ÿéƒ¨ç½² KubeEdge è¾¹ç¼˜è®¡ç®—åŸºç¡€è®¾æ–½ã€‚

### å®Œæ•´ç¦»çº¿æ”¯æŒ

âœ… **äº‘ç«¯é•œåƒå®Œæ•´æ‰“åŒ…** (æœ€æ–°ä¿®å¤)
- åŒ…å«æ‰€æœ‰ K3s ç³»ç»Ÿé•œåƒ (8ä¸ª)
- åŒ…å«æ‰€æœ‰ KubeEdge ç»„ä»¶é•œåƒ (4ä¸ª)
  - cloudcore:v1.22.0
  - iptables-manager:v1.22.0
  - controller-manager:v1.22.0
  - admission:v1.22.0
- å®‰è£…å‰è‡ªåŠ¨é¢„å¯¼å…¥ï¼Œæ— éœ€è”ç½‘

## å¿«é€Ÿå¼€å§‹

### äº‘ç«¯å®‰è£…ï¼ˆä¸€é”®éƒ¨ç½²ï¼‰

```bash
# 1. å‡†å¤‡ç¦»çº¿åŒ…ï¼ˆåœ¨æœ‰ç½‘ç»œçš„æœºå™¨ä¸Šï¼‰
cd cloud/build
bash build.sh amd64  # æˆ– arm64

# 2. ä¸Šä¼ ç”Ÿæˆçš„åŒ…åˆ°äº‘ç«¯æœåŠ¡å™¨ï¼Œç„¶åæ‰§è¡Œå®‰è£…
sudo bash ../install/install.sh \
  --package /path/to/kubeedge-cloud-amd64-k3s.tar.gz \
  --cloud-ip 10.0.0.1 \
  --port 10000
```

å®‰è£…å®Œæˆåå°†è‡ªåŠ¨è¾“å‡ºè¾¹ç¼˜èŠ‚ç‚¹çš„æ¥å…¥ tokenã€‚

### è¾¹ç¼˜ç«¯å®‰è£…ï¼ˆä¸€é”®éƒ¨ç½²ï¼‰

```bash
# 1. å‡†å¤‡ç¦»çº¿åŒ…
cd edge/build
bash build.sh amd64  # æˆ– arm64

# 2. ä¸Šä¼ åŒ…åˆ°è¾¹ç¼˜èŠ‚ç‚¹ï¼Œç„¶åæ‰§è¡Œå®‰è£…
sudo bash ../install/install.sh \
  --package /path/to/kubeedge-edge-amd64.tar.gz \
  --cloud-url wss://10.0.0.1:10000/edge/node-name \
  --token YOUR_TOKEN_FROM_CLOUD \
  --node-name node-name
```

## é¡¹ç›®ç»“æ„

```
kubeprepare/
â”œâ”€â”€ cloud/                          # äº‘ç«¯ç›¸å…³
â”‚   â”œâ”€â”€ build/
â”‚   â”‚   â””â”€â”€ build.sh               # æ„å»ºäº‘ç«¯ç¦»çº¿åŒ…
â”‚   â”œâ”€â”€ install/
â”‚   â”‚   â”œâ”€â”€ install.sh             # äº‘ç«¯å®‰è£…è„šæœ¬
â”‚   â”‚   â””â”€â”€ README.md              # äº‘ç«¯è¯¦ç»†è¯´æ˜
â”‚   â””â”€â”€ release/                   # ç”Ÿæˆçš„ç¦»çº¿åŒ…å­˜æ”¾ä½ç½®
â”œâ”€â”€ edge/                           # è¾¹ç¼˜ç«¯ç›¸å…³
â”‚   â”œâ”€â”€ build/
â”‚   â”‚   â””â”€â”€ build.sh               # æ„å»ºè¾¹ç¼˜ç«¯ç¦»çº¿åŒ…
â”‚   â”œâ”€â”€ install/
â”‚   â”‚   â”œâ”€â”€ install.sh             # è¾¹ç¼˜ç«¯å®‰è£…è„šæœ¬
â”‚   â”‚   â””â”€â”€ README.md              # è¾¹ç¼˜ç«¯è¯¦ç»†è¯´æ˜
â”‚   â””â”€â”€ release/                   # ç”Ÿæˆçš„ç¦»çº¿åŒ…å­˜æ”¾ä½ç½®
â”œâ”€â”€ cleanup.sh                      # æ¸…ç†è„šæœ¬ï¼ˆç”¨äºé‡æ–°å®‰è£…ï¼‰
â””â”€â”€ README.md                       # æœ¬æ–‡ä»¶
```

## åŠŸèƒ½ç‰¹æ€§

âœ… **å®Œå…¨ç¦»çº¿æ”¯æŒ** - æ‰€æœ‰äºŒè¿›åˆ¶æ–‡ä»¶ã€é…ç½®å’Œå®¹å™¨é•œåƒå·²å®Œæ•´æ‰“åŒ…
  - åŒ…å« 13 ä¸ªå®¹å™¨é•œåƒï¼ˆ8ä¸ªK3s + 4ä¸ªKubeEdge + 1ä¸ªEdgeMeshï¼‰
  - åŒ…å« EdgeMesh Helm Chart (v1.17.0) ç”¨äºç¦»çº¿æœåŠ¡ç½‘æ ¼éƒ¨ç½²
  - æ”¯æŒçº¯ç¦»çº¿ç¯å¢ƒéƒ¨ç½²ï¼Œæ— éœ€ä»»ä½•ç½‘ç»œè¿æ¥

âœ… **å¤šæ¶æ„æ”¯æŒ** - amd64 å’Œ arm64 å…¼å®¹

âœ… **ä¸€é”®å®‰è£…** - äº‘ç«¯å’Œè¾¹ç¼˜ç«¯éƒ½æ”¯æŒè‡ªåŠ¨åŒ–éƒ¨ç½²

âœ… **é•œåƒé¢„å¯¼å…¥** - å®‰è£…å‰è‡ªåŠ¨åŠ è½½æ‰€æœ‰é•œåƒï¼Œé¿å…åœ¨çº¿æ‹‰å–

âœ… **Token å®‰å…¨æœºåˆ¶** - äº‘ç«¯è‡ªåŠ¨ç”Ÿæˆ token ä¾›è¾¹ç¼˜ç«¯æ¥å…¥

âœ… **æŒç»­é›†æˆ** - è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒåˆ° GitHub Release

âœ… **å®Œæ•´æ€§éªŒè¯** - æä¾›éªŒè¯è„šæœ¬ç¡®ä¿ç¦»çº¿åŒ…å®Œæ•´æ€§

âœ… **EdgeMesh æœåŠ¡ç½‘æ ¼** - è¾¹ç¼˜èŠ‚ç‚¹ä½¿ç”¨ host ç½‘ç»œ + EdgeMesh å®ç°æœåŠ¡å‘ç°å’Œé€šä¿¡
  - æ— éœ€ CNI æ’ä»¶é…ç½®
  - æ”¯æŒè¾¹ç¼˜åˆ°è¾¹ç¼˜çš„æœåŠ¡è®¿é—®
  - æ”¯æŒè¾¹ç¼˜åˆ°äº‘ç«¯çš„æœåŠ¡è®¿é—®

## ç½‘ç»œæ¶æ„

### è¾¹ç¼˜èŠ‚ç‚¹ç½‘ç»œæ¨¡å¼

è¾¹ç¼˜èŠ‚ç‚¹é‡‡ç”¨ **host ç½‘ç»œæ¨¡å¼**ï¼Œä¸ä½¿ç”¨ CNI æ’ä»¶ï¼š
- âœ… ç®€åŒ–é…ç½®ï¼Œæ— éœ€ä¸ºæ¯ä¸ªè¾¹ç¼˜èŠ‚ç‚¹åˆ†é…ç‹¬ç«‹çš„ Pod ç½‘æ®µ
- âœ… æ›´é€‚åˆè¾¹ç¼˜åœºæ™¯çš„èµ„æºé™åˆ¶
- âœ… é€šè¿‡ EdgeMesh å®ç°æœåŠ¡ç½‘æ ¼èƒ½åŠ›

### EdgeMesh æœåŠ¡ç½‘æ ¼

EdgeMesh æä¾›è¾¹ç¼˜æœåŠ¡å‘ç°å’Œæµé‡ä»£ç†ï¼š
- **æœåŠ¡å‘ç°**: é€šè¿‡ EdgeMesh DNS (169.254.96.16)
- **æµé‡ä»£ç†**: EdgeMesh Agent å®ç°æœåŠ¡é—´é€šä¿¡
- **é«˜å¯ç”¨**: æ”¯æŒé…ç½®å¤šä¸ªä¸­ç»§èŠ‚ç‚¹
- **è·¨ç½‘ç»œ**: æ”¯æŒè¾¹ç¼˜èŠ‚ç‚¹åœ¨ä¸åŒç½‘ç»œç¯å¢ƒä¸‹çš„é€šä¿¡

> ğŸ“˜ è¯¦ç»†éƒ¨ç½²æ­¥éª¤è¯·å‚è€ƒ [EdgeMesh éƒ¨ç½²æŒ‡å—](./docs/EDGEMESH_DEPLOYMENT.md)

## è¯¦ç»†æ–‡æ¡£

### å®‰è£…æŒ‡å—
- [äº‘ç«¯å®‰è£…æŒ‡å—](./cloud/install/README.md) - K3s + CloudCore å®Œæ•´å®‰è£…æµç¨‹
- [è¾¹ç¼˜ç«¯å®‰è£…æŒ‡å—](./edge/install/README.md) - EdgeCore å®‰è£…å’Œé…ç½®
- [å¿«é€Ÿéƒ¨ç½²æŒ‡å—](./docs/QUICK_DEPLOY.md) - å¿«é€Ÿä¸Šæ‰‹éƒ¨ç½²æ­¥éª¤

### é…ç½®å’Œæœ€ä½³å®è·µ
- [EdgeMesh éƒ¨ç½²æŒ‡å—](./docs/EDGEMESH_DEPLOYMENT.md) - è¾¹ç¼˜æœåŠ¡ç½‘æ ¼å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆï¼ˆå«å®˜æ–¹æœ€ä½³å®è·µï¼‰
- [EdgeCore é…ç½®æœ€ä½³å®è·µ](./docs/EDGECORE_CONFIG_BEST_PRACTICES.md) - EdgeCore + EdgeMesh æœ€å°åŒ–é…ç½®
- [K3s ç½‘ç»œé…ç½®è¯¦è§£](./docs/K3S_NETWORK_CONFIG.md) - K3s ç½‘ç»œæ¶æ„å’Œé…ç½®è¯´æ˜

### åŠŸèƒ½æ‰©å±•
- [IoT MQTT é›†æˆæŒ‡å—](./docs/IOT_MQTT_INTEGRATION.md) - è¾¹ç¼˜ç«¯ MQTT Broker éƒ¨ç½²
- [SSH å¯†é’¥é…ç½®](./docs/SSH_KEY_SETUP.md) - SSH å…å¯†è®¿é—®é…ç½®

### æŠ€æœ¯ç ”ç©¶å’Œåˆ†æ
- [é¡¹ç›®ç»“æ„è¯´æ˜](./docs/PROJECT_STRUCTURE.md) - é¡¹ç›®ç›®å½•å’Œæ–‡ä»¶ç»„ç»‡
- [CI/CD æ¶æ„è®¾è®¡](./docs/CI_CD_ARCHITECTURE.md) - GitHub Actions è‡ªåŠ¨åŒ–æ„å»º
- [æ„å»ºæµç¨‹æ€»ç»“](./docs/BUILD_FLOW_SUMMARY.md) - ç¦»çº¿åŒ…æ„å»ºæµç¨‹è¯¦è§£
- [ç¦»çº¿é•œåƒä¿®å¤æŠ¥å‘Š](./docs/OFFLINE_IMAGE_FIX.md) - å®Œæ•´ç¦»çº¿æ”¯æŒçš„æŠ€æœ¯å®ç°
- [CI/CD å˜æ›´æ—¥å¿—](./docs/CHANGELOG_CI_CD.md) - GitHub Actions é…ç½®å˜æ›´è®°å½•

### æµ‹è¯•å’ŒéªŒè¯
- [æµ‹è¯•æ£€æŸ¥æ¸…å•](./docs/TESTING_CHECKLIST.md) - å®Œæ•´çš„åŠŸèƒ½æµ‹è¯•æ¸…å•

## éªŒè¯å·¥å…·

### éªŒè¯äº‘ç«¯ç¦»çº¿åŒ…å®Œæ•´æ€§

```bash
# éªŒè¯æ„å»ºçš„ç¦»çº¿åŒ…æ˜¯å¦åŒ…å«æ‰€æœ‰å¿…éœ€é•œåƒ
bash verify_cloud_images.sh kubeedge-cloud-1.22.0-k3s-v1.34.2+k3s1-amd64.tar.gz
```

éªŒè¯å†…å®¹ï¼š
- âœ“ 4ä¸ªKubeEdgeç»„ä»¶é•œåƒ
- âœ“ 8ä¸ªK3sç³»ç»Ÿé•œåƒ  
- âœ“ æ‰€æœ‰å¿…éœ€çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œé…ç½®

## æ•…éšœæ’é™¤

### æ¸…ç†é‡æ–°å®‰è£…

```bash
sudo bash cleanup.sh
```

æ­¤è„šæœ¬å°†æ¸…ç†ï¼š
- edgecore å’Œ containerd æœåŠ¡
- ç›¸å…³äºŒè¿›åˆ¶æ–‡ä»¶
- é…ç½®æ–‡ä»¶å’Œæ•°æ®ç›®å½•

### EdgeMesh éƒ¨ç½²

**è‡ªåŠ¨éƒ¨ç½² (æ¨è):**
- cloud å®‰è£…è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ helm-charts ç›®å½•
- æç¤ºæ—¶é€‰æ‹© `y` å³å¯è‡ªåŠ¨éƒ¨ç½² EdgeMesh
- PSK å¯†ç è‡ªåŠ¨ç”Ÿæˆå¹¶ä¿å­˜åˆ° `edgemesh-psk.txt`

**æ‰‹åŠ¨éƒ¨ç½²:**
```bash
# ä½¿ç”¨ cloud å®‰è£…åŒ…ä¸­çš„ç¦»çº¿ Helm Chart
cd /data/kubeedge-cloud-xxx
helm install edgemesh ./helm-charts/edgemesh.tgz \
  --namespace kubeedge \
  --set agent.image=kubeedge/edgemesh-agent:v1.17.0 \
  --set agent.psk="$(openssl rand -base64 32)" \
  --set agent.relayNodes[0].nodeName=<master-node> \
  --set agent.relayNodes[0].advertiseAddress="{<äº‘ç«¯IP>}"
```

**å®Œå…¨ç¦»çº¿**: EdgeMesh é•œåƒå’Œ Helm Chart å·²é¢„å…ˆæ‰“åŒ…åœ¨ cloud å®‰è£…åŒ…ä¸­ï¼Œæ— éœ€å¤–ç½‘è¿æ¥ã€‚

è¯¦ç»†æ­¥éª¤å‚è€ƒ [EdgeMesh éƒ¨ç½²æŒ‡å—](./docs/EDGEMESH_DEPLOYMENT.md)

## ç‰ˆæœ¬ä¿¡æ¯

- **KubeEdge**: v1.22
- **k3s**: æœ€æ–°ç¨³å®šç‰ˆ
- **æ”¯æŒæ¶æ„**: amd64, arm64

